<!doctype html>
<html class="lazyload" lang="en">
    <head>
        <title>index · Obullo Php7 Router.</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
                <link rel="icon" type="image/png" href="/icon.png">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Share:400|Jaldi:400,700|Fira+Mono:400,700">
        <link rel="stylesheet" href="/assets/base.css">
        <link rel="stylesheet" href="/assets/lindoc.css">
                <script>
            // Parent Elements - e.P("body") - https://gist.github.com/moqmar/0995cf6595201f7a062fb173cb4ab938
            (function(E){E.matches||(E.matches=E.matchesSelector||E.msMatchesSelector||E.webkitMatchesSelector)})(Element.prototype)
            Element.prototype.P=function(s){var e=this
            if(!s||typeof s=="number")for(var i=0;i<(s||1);i++)e=e?e.parentElement:e
            else if(typeof s=="string")while(e&&!e.matches(s))e=e.parentElement
            else while(e&&e!=s)e=e.parentElement
            return e}
        </script>
    </head>
    <body>
        <header>
            <div class="nav">
                                <div style="text-align: left;"><a href="#" style="font-weight:bold;font-size:54px;">Documentation</a> </div>
                                            </div>
            <div class="language">
                <input type="checkbox" id="language-select">
                <label for="language-select"><img src="/assets/flags/en.png"></label>
                <div class="language-select-popup" data-default-language="en">
                    <a href="/"><img src="/assets/flags/en.png"></a>
                    <a href="/tr/"><img src="/assets/flags/tr.png"></a>
                </div>
                <script>
                    document.getElementById("language-select").checked = false;
                    window.addEventListener("click", function(event) {
                        if (!event.target.P(".language")) document.getElementById("language-select").checked = false;
                    })
                </script>
            </div>
        </header>

        <main>
            <aside class="toc"><ul></ul></aside>
            <article>

<!-- CONTENT START -->
<h1 id="obullo--router">Obullo / Router</h1>
<p><a href="https://travis-ci.org/obullo/Router"><img src="https://travis-ci.org/obullo/Router.svg?branch=master" alt="Build Status" /></a>
<a href="LICENSE.md"><img src="https://img.shields.io/badge/license-MIT-brightgreen.svg" alt="Software License" /></a>
<a href="https://packagist.org/packages/obullo/router"><img src="https://img.shields.io/packagist/dt/obullo/router.svg" alt="Total Downloads" /></a></p>
<blockquote>
<p>Obullo router <a href="https://docs.djangoproject.com/en/2.0/topics/http/urls/">Django Url Dispatcher</a> kütüphanesinden ilham alınarak geliştirilmiş bağımsız bir route paketidir.</p>
</blockquote>
<h2 id="ykleme">Yükleme</h2>
<pre><code class="language-bash">$ composer require obullo/router</code></pre>
<h2 id="host-konfigrasyonu">Host konfigürasyonu</h2>
<p><a href="configuration.html">CONFIGURATION.md</a></p>
<h2 id="gereksinimler">Gereksinimler</h2>
<p>Bu versiyon aşağıdaki PHP sürümleri tarafından destekleniyor.</p>
<ul>
<li>7.0</li>
<li>7.1</li>
<li>7.2</li>
</ul>
<h2 id="test">Test</h2>
<pre><code class="language-bash">$ vendor/bin/phpunit</code></pre>
<h2 id="hzl-balang">Hızlı başlangıç</h2>
<pre><code class="language-php">require '../vendor/autoload.php';

use Obullo\Router\Route;
use Obullo\Router\RequestContext;
use Obullo\Router\RouteCollection;
use Obullo\Router\Router;
use Obullo\Router\Types\{
    StrType,
    IntType
};
$configArray = array(
    'types' =&gt; [
        new IntType('&lt;int:id&gt;'),
        new StrType('&lt;str:name&gt;'),
    ]
);
$config = new Zend\Config\Config($configArray);</code></pre>
<p>Psr7 İsteği</p>
<pre><code class="language-php">$request = Zend\Diactoros\ServerRequestFactory::fromGlobals();
$context = new RequestContext;
$context-&gt;fromRequest($request);</code></pre>
<p>Route Kolleksiyonu</p>
<pre><code class="language-php">$collection = new RouteCollection($config);
$collection-&gt;setContext($context);
$collection-&gt;add('home', new Route('GET', '/', 'App\Controller\DefaultController::index'));
$collection-&gt;add(
    'dummy',
    new Route(
        'GET',
        '/dummy/index/&lt;int:id&gt;/&lt;str:name&gt;',
        'App\Controller\DummyController::index'
        ['App\Middleware\Dummy::class']
    )
);</code></pre>
<p>Route Sınıfı</p>
<pre><code class="language-php">$route = $collection-&gt;get('dummy');

echo $route-&gt;getHandler(); //  "App\Controller\DummyController::index"
echo $route-&gt;getMethods()[0]; // GET
echo $route-&gt;getPattern(); //  "/dummy/index/(?\d+)/(?\w+)"
echo $route-&gt;getStack()[0]; // App\Middleware\Dummy::class</code></pre>
<p>Url Çözümleme</p>
<pre><code class="language-php">$router = new Router($collection);

if ($route = $router-&gt;matchRequest()) {

    $handler = $route-&gt;getHandler();
    $args = array_merge(array('request' =&gt; $request), $route-&gt;getArguments());
    $response = null;
    if (is_callable($handler)) {
        $exp = explode('::', $handler);
        $class = new $exp[0];
        $method = $exp[1];
        $response = call_user_func_array(array($class, $method), $args);
    }
    if ($response instanceof Psr\Http\Message\ResponseInterface) {
        echo $response-&gt;getBody();  // DummyController::index
    }
}</code></pre>
<p>App\Controller\DummyController örneği</p>
<pre><code class="language-php">namespace App\Controller;

use Zend\Diactoros\Response\HtmlResponse;
use Psr\Http\Message\RequestInterface as Request;

class DummyController
{
    public function index(Request $request)
    {
        return new HtmlResponse('DummyController::index');
    }
}</code></pre>
<h2 id="tr-konfigrasyonu">Tür konfigürasyonu</h2>
<blockquote>
<p>Türler route kuralları içerisindeki argümanların daha esnek bir biçimde yönetilmesini sağlar ve güvenliği arttırır.</p>
</blockquote>
<pre><code class="language-php">$configArray = array(
    'types' =&gt; [
        new IntType('&lt;int:id&gt;'),
        new StrType('&lt;str:name&gt;'),
        new StrType('&lt;str:word&gt;'),
        new AnyType('&lt;any:any&gt;'),
        new BoolType('&lt;bool:status&gt;'),
        new IntType('&lt;int:page&gt;'),
        new SlugType('&lt;slug:slug&gt;'),
        new SlugType('&lt;slug:slug_&gt;', '(?&lt;%s&gt;[\w-_]+)'), // slug with underscore
    ]
);
$config = new Zend\Config\Config($configArray);</code></pre>
<blockquote>
<p><code>Zend\Config</code> paketi yerine <code>ArrayAccess</code> sınıfına genişleyen herhangi bir konfigürasyon paketi kullanabilirsiniz.</p>
</blockquote>
<h3 id="varsaylan-trler">Varsayılan türler</h3>
<table><thead><tr><th>Tür</th>    
            <th>Regex</th>
            <th>Route</th>
            <th>Php</th>
            <th>Url</th>
        </tr></thead><tbody><tr><td>AnyType</td>
            <td>(?&lt;any&gt;.*)</td>
            <td>http://example.com/&lt;any:any&gt;</td>
            <td>string</td>
            <td>http://example.com/%s</td>
        </tr><tr><td>BoolType</td>
            <td>(?&lt;status&gt;[0-1])</td>
            <td>http://example.com/&lt;bool:status&gt;</td>
            <td>boolean</td>
            <td>http://example.com/%01d</td>
        </tr><tr><td>FourDigitYearType</td>
            <td>(?&lt;year&gt;[0-9]{4})</td>
            <td>http://example.com/&lt;yyyy:year&gt;</td>
            <td>integer</td>
            <td>http://example.com/%04d</td>
        </tr><tr><td>IntType</td>
            <td>(?&lt;id&gt;\d+)</td>
            <td>http://example.com/&lt;int:id&gt;</td>
            <td>integer</td>
            <td>http://example.com/%d</td>
        </tr><tr><td>SlugType</td>
            <td>(?&lt;slug&gt;[\w-]+)</td>
            <td>http://example.com/&lt;slug:slug&gt;</td>
            <td>string</td>
            <td>http://example.com/%s</td>
        </tr><tr><td>StrType</td>
            <td>(?&lt;name&gt;\w+)</td>
            <td>http://example.com/&lt;str:name&gt;</td>
            <td>string</td>
            <td>http://example.com/%s</td>
        </tr><tr><td>TranslationType</td>
            <td>(?&lt;locale&gt;[a-z]{2})</td>
            <td>http://example.com/&lt;locale:locale&gt;</td>
            <td>string</td>
            <td>http://example.com/%02s</td>
        </tr><tr><td>TwoDigitDayType</td>
            <td>(?&lt;day&gt;[0-9]{2})</td>
            <td>http://example.com/&lt;dd:day&gt;</td>
            <td>integer</td>
            <td>http://example.com/%02d</td>
        </tr><tr><td>TwoDigitMonthType</td>
            <td>(?&lt;month&gt;[0-9]{2})</td>
            <td>http://example.com/&lt;mm:month&gt;</td>
            <td>integer</td>
            <td>http://example.com/%02d</td>
        </tr></tbody></table>
<p>Aşağıda <code>Int</code> türüne ait bir örnek gösteriliyor.</p>
<pre><code class="language-php">class IntType extends Type
{
    protected $regex = '(?&lt;%s&gt;\d+)';

    /**
     * Php format
     * 
     * @param  number $value 
     * @return int
     */
    public function toPhp($value)
    {
        return (int)$value;
    }

    /**
     * Url format
     * 
     * @param mixed $value
     * @return string
     */
    public function toUrl($value)
    {
        return sprintf('%d', $value);
    }
}</code></pre>
<ul>
<li><code>regex</code> değişkeni içerisindeki <code>%s</code> değeri <code>&lt;int:id&gt;</code> gibi bir türe ilişkin ismin <code>(?&lt;id&gt;\d+)</code> ifadesine dönüştürülmesini sağlar.</li>
<li><code>toPhp</code> metodu gelen argüman türünü php içerisinde kullanılmadan önce belirlenen türe dönüştürür.</li>
<li><code>toUrl</code> metodu <code>%s</code> biçimindeki değerleri <code>sprintf</code> ile biçimlendirir ve <code>UrlGenerator</code> sınıfı çağırıldığında url linkleri oluşturmanızı sağlar.</li>
<li><code>Type</code> sınıfına genişleyerek kendi türlerinizi de oluşturabilirsiniz.</li>
</ul>
<p>Tanımlı tür fonksiyonlarından yeni bir düzenli ifade elde etmek için construct metodu ikinci parametresi kullanılabilir.</p>
<pre><code class="language-php">new SlugType('&lt;slug:slug&gt;');
new SlugType('&lt;slug:slug_&gt;', '(?&lt;%s&gt;[\w-_]+)');  // slug with underscore</code></pre>
<p>Klonlanan ikinci türe ait ismi değiştirmeniz gerekir. Yukarıdaki örnekte slug türü <code>&lt;slug:slug_&gt;</code> ismi ile klonlanarak alt çizgi desteği eklendi. </p>
<h2 id="ykleyiciler">Yükleyiciler</h2>
<p>Uygulamanızı daha anlaşılabilir kılmak amacı ile route kolleksiyonunu  bir dosya içerisinde tutmak isteyebilirsiniz. Yükleyiciler uygulamanızda tanımlı olan bir route dosyasını okuyarak route kolleksiyon sınıfını oluştururlar.</p>
<h3 id="yaml-dosya-ykleyicisi">Yaml dosya yükleyicisi</h3>
<p>Örnek bir .yaml dosyası</p>
<pre><code>home: 
    path: /
    handler: App\Controller\DefaultController::index
admin/:
    host: example.com
    scheme: http
    middleware: 
        - App\Middleware\Dummy
    dummy:
        path: /dummy/&lt;str:name&gt;/&lt;int:id&gt;
        handler: App\Controller\DefaultController::dummy</code></pre>
<pre><code class="language-php">require '../vendor/autoload.php';

use Obullo\Router\Route;
use Obullo\Router\RequestContext;
use Obullo\Router\RouteCollection;
use Obullo\Router\Router;
use Obullo\Router\Types\{
    StrType,
    IntType
};
$configArray = array(
    'types' =&gt; [
        new IntType('&lt;int:id&gt;'),
        new StrType('&lt;str:name&gt;'),
    ]
);
$config = new Zend\Config\Config($configArray);</code></pre>
<p>Psr7 İsteği</p>
<pre><code class="language-php">$request = Zend\Diactoros\ServerRequestFactory::fromGlobals();
$context = new RequestContext;
$context-&gt;fromRequest($request);

$collection = new RouteCollection($config);
$collection-&gt;setContext($context);</code></pre>
<p>Yükleyici</p>
<pre><code class="language-php">$loader = new YamlFileLoader;
$loader-&gt;load('/var/www/MyProject/App/routes.yaml');
$collection = $loader-&gt;build($collection);</code></pre>
<p>Url Çözümleme</p>
<pre><code class="language-php">$router = new Router($collection);
if ($route = $router-&gt;matchRequest()) {

}</code></pre>
<h3 id="php-dosya-ykleyicisi">Php dosya yükleyicisi</h3>
<p>Örnek bir .php dosyası</p>
<pre><code>return [
    'home' =&gt; [
        'path'   =&gt; '/',
        'handler'=&gt; 'App\Controller\DefaultController::index',
    ],
    'admin/' =&gt; [
        'host' =&gt; 'example.com',
        'scheme' =&gt; 'http',
        'middleware' =&gt; [App\Middleware\Auth::class],
        'dummy' =&gt; [
            'path'   =&gt; '/dummy/&lt;str:name&gt;/&lt;int:id&gt;',
            'handler'=&gt; 'App\Controller\DefaultController::dummy',
        ]
    ]
];</code></pre>
<p>Yükleyici</p>
<pre><code class="language-php">$loader = new PhpFileLoader;
$loader-&gt;load('/var/www/MyProject/App/routes.php');
$collection = $loader-&gt;build($collection);</code></pre>
<p>Bu kısımda sadece yükleyici değiştirmeniz yeterli olacaktır.</p>
<h2 id="pipe-ile-gruplama">Pipe ile gruplama</h2>
<p>Bir api tasarlıyorsanız yada uygulamanız genişleyebilir bir uygulama ise pipe ile uygulamayı parçalara ayırmak uygulamanızın performansını arttırır. </p>
<p>Örneğin <code>users/</code> adında bir veri yolu oluşturursak bir pipe bu gruba ait nitelikleri url parçaları üzerinde birleştirir.</p>
<pre><code class="language-php">$pipe = new Pipe('users/', [App\Middleware\Dummy::class], '&lt;str:name&gt;.router');
$pipe-&gt;add('test', new Route('GET', '/test', 'App\Controller\DefaultController::test'));</code></pre>
<p>Http isteği <code>users/</code> gelmediği sürece bu nesneye ait route kümeleri için <code>preg_match</code> operasyonu uygulanmaz ve uygulamanız parçalara ayrıldığı için performanstan kazanılmış olur.</p>
<pre><code class="language-php">$collection = new RouteCollection($config);
$collection-&gt;setContext($context);

$collection-&gt;add('home', new Route('GET', '/', 'App\Controller\DefaultController::index'));

$pipe = new Pipe('users/example/', [App\Middleware\Dummy::class], '&lt;str:name&gt;.router');
$pipe-&gt;add('dummy', new Route('GET', '/&lt;int:id&gt;/&lt;str:name', 'App\Controller\DefaultController::test'));
$collection-&gt;addPipe($pipe);</code></pre>
<p>Eklenen bir route adına ait değerleri test etmek;</p>
<pre><code class="language-php">$route = $collection-&gt;get('users/example/dummy');

echo $route-&gt;getHandler(); //  "App\Controller\DefaultController::test"
echo $route-&gt;getMethods()[0]; // GET
echo $route-&gt;getPattern(); //  "/users/example/(?\d+)/(?\w+)"</code></pre>
<h3 id="yaml-iinde-pipe">Yaml içinde pipe</h3>
<p>Eğer en yüksek seviyedeki bir kuralın son karakteri forward slash <code>"/"</code> ile bitiyorsa bu kural pipe olarak işlem görür.  Örnek <code>"users/"</code>.</p>
<pre><code>users/:
    middleware: 
        - App\Middleware\Dummy
    dummy:
        path: /&lt;int:id&gt;/&lt;str:name&gt;
        handler: App\Controller\DefaultController::test</code></pre>
<h2 id="url-zmleme">Url Çözümleme</h2>
<h3 id="matchrequest">MatchRequest</h3>
<p>MatchRequest metodu <code>Psr7 Request</code> nesnesi üzerinden gelen bir http isteğini çözümler. Aşağıdaki gibi bir url yapısına sahip olduğumuzu düşünelim.</p>
<pre><code>http://example.com/&lt;int:id&gt;
http://example.com/&lt;int:id&gt;/&lt;str:name&gt;/</code></pre>
<p>Opsiyonel parametre için tanımlar</p>
<pre><code class="language-php">$collection-&gt;add(
    'dummy/id',
    new Route('GET', '/&lt;int:id&gt;', 'App\Controller\DummyController::index')
);
$collection-&gt;add(
    'dummy/id/name',
    new Route('GET', '/&lt;int:id&gt;/&lt;str:name&gt;', 'App\Controller\DummyController::index')
);</code></pre>
<p>Eşleşme</p>
<pre><code class="language-php">$router = new Router($collection);

if ($route = $router-&gt;matchRequest()) {

    $handler = $route-&gt;getHandler();
    $methods = $route-&gt;getMethods();
    if (! in_array($request-&gt;getMethod(), $methods)) {
        throw new Exception(
            sprintf('Method %s is not allowed.', $request-&gt;getMethod())
        );
    }
    $args = array_merge(array('request' =&gt; $request), $route-&gt;getArguments());
    // Parse handlers
    $response = null;
    if (is_callable($handler)) {
        $exp = explode('::', $handler);
        $class = new $exp[0];
        $method = $exp[1];
        $response = call_user_func_array(array($class, $method), $args);
    }
    // Emit response
    if ($response instanceof Psr\Http\Message\ResponseInterface) {
        echo $response-&gt;getBody();
    }
}</code></pre>
<p>App\Controller\DummyController sınıfı</p>
<pre><code class="language-php">namespace App\Controller;

use Zend\Diactoros\Response\HtmlResponse;
use Psr\Http\Message\RequestInterface as Request;

class DummyController
{
    public function index(Request $request, int $id, $name = '')
    {
        return new HtmlResponse(
            'Variables: #id:'.sprintf('%d', $id).' #name:'.sprintf('%s', $name)
        );
    }
}</code></pre>
<blockquote>
<p>ReflectionClass sınıfı kullanarak kontrolör sınıfı çözümlenirken dependency injection yöntemi ile bu sınıfa ait nesneleri otomatik çağırabilirsiniz.</p>
</blockquote>
<h3 id="match">Match</h3>
<p>Match metodu <code>Psr7 Request</code> nesnesi olmadan eşleşme gerçekleştirmeye olanak sağlar. Aşağıdaki gibi bir url yapısına sahip olduğumuzu düşünelim.</p>
<pre><code>http://example.com/&lt;str:name&gt;/&lt;int:id&gt;</code></pre>
<pre><code class="language-php">$collection = new RouteCollection($config);
$collection-&gt;setContext($context);
$collection-&gt;add(
    'dummy',
    new Route(
        'GET',
        '/dummy/&lt;str:name&gt;/&lt;int:id&gt;',
        'App\Controller\DefaultController::dummy'
    )
);</code></pre>
<p>Eşleşme</p>
<pre><code class="language-php">$router = new Router($collection);

if ($route = $router-&gt;match('/dummy/test/55','example.com','http')) {
    $args = $route-&gt;getArguments();

    var_dump($args['name']); // string "test"
    var_dump($args['id']); // integer 55

    echo $route-&gt;getMethods()[0]; // GET
    echo $route-&gt;getHandler(); // App\Controller\DefaultController::dummy
}</code></pre>
<h2 id="koullu-tanmlamalar">Koşullu tanımlamalar</h2>
<p>Koşullu tanımlamalar eşleşmeyi koşula bağlarlar. Koşullar bir route yada pipe nesnesi için tanımlanabilir.</p>
<h3 id="host">Host</h3>
<p>Aşağıdaki route kuralının çalışabilmesi <code>test.example.com</code> host eşleşmesine bağlıdır.</p>
<pre><code class="language-php">$collection-&gt;add('dummy',
    new Route(
        ['GET','POST'],
        '/dummy/(?&lt;name&gt;\w+)',
        'App\Controller\DefaultController:index',
        [],
        'test.example.com'
    )
);</code></pre>
<p>Aşağıdaki route kuralının çalışabilmesi  <code>(?&lt;name&gt;\w+).example.com</code> host eşleşmesine bağlıdır.</p>
<pre><code class="language-php">$collection-&gt;add('dummy',
    new Route(
        ['GET','POST'],
        '/dummy/(?&lt;name&gt;\w+)',
        'App\Controller\DefaultController:index',
        [],
        '&lt;str:name&gt;.example.com'
    )
);</code></pre>
<p>Host değeri eğer bir düzenli ifade ise <code>$router-&gt;getMatchedHosts()</code> metodu ile host eşleşmeleri alınabilir.</p>
<pre><code class="language-php">$router = new Router($collection);

if ($router-&gt;matchRequest()) {
    echo $router-&gt;getMatchedHosts()[0]; // test.example.com
    echo $router-&gt;getMatchedHosts()['name']; // test
}</code></pre>
<p>Pipe için bir örnek</p>
<pre><code class="language-php">$pipe = new Pipe('test/','App\Middleware\Dummy','&lt;str:name&gt;.example.com',['http','https']);</code></pre>
<h3 id="scheme">Scheme</h3>
<p>Bir route yada pipe kuralının son parametresi eşleşmeyi uri scheme koşuluna bağlar.</p>
<pre><code class="language-php">$collection-&gt;add('dummy',
    new Route(
        ['GET','POST'],
        '/dummy/(?&lt;name&gt;\w+)',
        'App\Controller\DefaultController:index',
        [],
        'test.example.com'
        ['http', 'https']
    )
);</code></pre>
<p>Yaml içinde,</p>
<pre><code>admin/:
    host: admin.example.com
    scheme:
        - http
        - https
    middleware:
        - App\Middleware\Auth
    dummy:
        path: /dummy/&lt;str:name&gt;
        handler: App\Controller\UserController::dummy</code></pre>
<h3 id="koullu-ykleyici">Koşullu yükleyici</h3>
<p>Herbir alt domain adına ait farklı route dosyası yükleyen bir yükleyici.</p>
<pre><code class="language-php">$subdomain = strstr($context-&gt;getHost(), '.example.com', true); // admin

$loader-&gt;load('/var/www/MyProject/'.$subdomain.'_routes.yaml');
$collection = $loader-&gt;build($collection);</code></pre>
<h2 id="katmanlar">Katmanlar</h2>
<h3 id="middleware-eklemek">Middleware eklemek</h3>
<p>Router sınıfı dördüncü parametresi bir router kuralına,</p>
<pre><code class="language-php">$collection-&gt;add('dummy',
    new Route(
        ['GET','POST'],
        '/dummy/(?&lt;name&gt;\w+)',
        'App\Controller\DefaultController:index',
        [App\Middleware\Dummy],
    )
);</code></pre>
<p>pipe sınıfı ikinci parametresi ise bir pipe nesnesine http katmanı tayin eder.</p>
<pre><code class="language-php">$pipe = new Pipe('test/','App\Middleware\Dummy','&lt;str:name&gt;.example.com',['http','https']);</code></pre>
<p>Yaml içinde,</p>
<pre><code>users/:
    middleware: 
        - App\Middleware\Dummy
    dummy:
        path: /&lt;int:id&gt;/&lt;str:name&gt;
        handler: App\Controller\DefaultController::test
        middleware: App\Middleware\Test</code></pre>
<h3 id="middleware-dizisini-almak">Middleware dizisini almak</h3>
<p>Router nesnesi <code>getStack</code> metodu route kolleksiyonuna atanan tüm middleware sınıflarına ulaşmanızı sağlar.</p>
<pre><code class="language-php">if ($router-&gt;matchRequest()) {
    print_r($router-&gt;getStack()); // Array ( [0] =&gt; App\Middleware\Dummy)
}</code></pre>
<h2 id="yerelletirme">Yerelleştirme</h2>
<p>Route kurallarınıza çoklu dil desteği eklemek için <code>TranslationType</code> sınıfının konfigüre edilmesi gerekir. </p>
<pre><code class="language-php">$configArray = array(
    'types' =&gt; [
        new IntType('&lt;int:id&gt;'),
        new StrType('&lt;str:name&gt;'),
        new TranslationType('&lt;locale:locale&gt;'),
    ]
);
$config = new Zend\Config\Config($configArray);</code></pre>
<p>Dilleri belirli değerlere sınırlamak için ikinci parametreyi kullanabilirsiniz.</p>
<pre><code class="language-php">new TranslationType('&lt;locale:locale&gt;', '(?&lt;%s&gt;(en|de|es))');</code></pre>
<p>Aşağıdaki gibi bir url yapımız olduğunu varsayalım.</p>
<pre><code>http://example.com/en/dummy/test</code></pre>
<pre><code class="language-php">$collection-&gt;add(
    'dummy',
    new Route(
        'GET',
        '/&lt;locale:locale&gt;/dummy/&lt;str:name&gt;',
        'App\Controller\DummyController::test'
    )
);</code></pre>
<p>Eşleşen route kuralına ait yerel argümanı $request nesnesine ekleyebilirsiniz. Yerel değer kopyalandıktan sonra argümanlardan aşağıdaki gibi silinmelidir.</p>
<pre><code class="language-php">if ($route = $router-&gt;matchRequest()) {
    $locale  = $route-&gt;getArgument('locale');
    $request = $request-&gt;withAttribute('locale', $locale);
    $route-&gt;removeArgument('locale');
}</code></pre>
<p>Tam örnek </p>
<pre><code class="language-php">if ($route = $router-&gt;matchRequest()) {

    $response = null;
    $locale  = $route-&gt;getArgument('locale');
    $request = $request-&gt;withAttribute('locale', $locale);
    $route-&gt;removeArgument('locale');

    $args = array_merge(array('request' =&gt; $request), $route-&gt;getArguments());
    $handler = $route-&gt;getHandler();

    // Parse handlers
    if (is_callable($handler)) {
        $exp = explode('::', $handler);
        $class = new $exp[0];
        $method = $exp[1];
        $response = call_user_func_array(array($class, $method), $args);
    }
    // Emit response
    if ($response instanceof Psr\Http\Message\ResponseInterface) {
        echo $response-&gt;getBody();
    }
}</code></pre>
<p>App\Controller\DummyController sınıfı</p>
<pre><code class="language-php">namespace App\Controller;

use Zend\Diactoros\Response\HtmlResponse;
use Psr\Http\Message\RequestInterface as Request;

class DummyController
{
    public function test(Request $request)
    {
        $locale = $request-&gt;getAttribute('locale');

        return new HtmlResponse('DummyController::test #locale:'.sprintf('%02s', $locale));
    }
}</code></pre>
<h2 id="url-retici">Url üretici</h2>
<p>Url üreticisi türler içerisinde <code>toUrl</code> metodunu kullanarak güvenli url adresleri yaratır.</p>
<pre><code class="language-php">public function toUrl($value)
{
    return sprintf('%d', $value);
}</code></pre>
<p>Bir örnek.</p>
<pre><code class="language-php">$collection-&gt;add(
    'dummy/name',
    new Route(
        'GET',
        '/&lt;locale:locale&gt;/dummy/&lt;str:name&gt;',
        'App\Controller\DefaultController::dummy'
    )
);</code></pre>
<p>Url generator sınıfına parametre gönderelim.</p>
<pre><code class="language-php">$generator = new UrlGenerator($collection);
echo $generator-&gt;generate('dummy/name', ['locale' =&gt; 'en', 'name' =&gt; 'test']);</code></pre>
<p>Yukarıdaki örneğin çıktısı</p>
<pre><code class="language-php">// '/en/dummy/test'</code></pre>
<p>Başka bir örnek.</p>
<pre><code class="language-php">$collection-&gt;add(
    'dummy/name/id',
    new Route('GET', '/&lt;str:name&gt;/&lt;int:id&gt;', 'App\Controller\DummyController::index')
);</code></pre>
<pre><code class="language-php">$generator = new UrlGenerator($collection);
echo $generator-&gt;generate('dummy/name/id', 'name' =&gt; 'test', 'id' =&gt; 5]);</code></pre>
<p>Yukarıdaki örneğin çıktısı</p>
<pre><code class="language-php">// '/test/5'</code></pre>
<h2 id="performans">Performans</h2>
<h3 id="obullo-router-paketi-zend-diactoros-ile">Obullo router paketi (Zend Diactoros ile)</h3>
<p>100 route testi, eşleşmenin en son route ile olması (en kötü senaryo)</p>
<pre><code>ab -n 1000 -c 100 http://router/dummy/index/850/test</code></pre>
<pre><code>Server Software:        Apache/2.4.27
Server Hostname:        router
Server Port:            80

Document Path:          /dummy/index/850/test
Document Length:        22 bytes

Concurrency Level:      100
Time taken for tests:   2.680 seconds
Complete requests:      1000
Failed requests:        0
Total transferred:      189000 bytes
HTML transferred:       22000 bytes
Requests per second:    373.09 [#/sec] (mean)
Time per request:       268.028 [ms] (mean)
Time per request:       2.680 [ms] (mean, across all concurrent requests)
Transfer rate:          68.86 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    2   6.3      0      26
Processing:    15  255  34.4    260     356
Waiting:        8  249  36.0    254     348
Total:         30  258  31.8    261     357

Percentage of the requests served within a certain time (ms)
  50%    261
  66%    267
  75%    270
  80%    272
  90%    280
  95%    294
  98%    324
  99%    344
 100%    357 (longest request)</code></pre>
<h3 id="hz-zerine-odaklanm-dier-route-paketleri-zend-diactoros-ile">Hız üzerine odaklanmış diğer route paketleri (Zend Diactoros ile)</h3>
<p>100 route testi, eşleşmenin en son route ile olması (en kötü senaryo)</p>
<pre><code>ab -n 1000 -c 100 http://router/dummy/index/850/test</code></pre>
<pre><code>Server Software:        Apache/2.4.27
Server Hostname:        router
Server Port:            80

Document Path:          /dummy/index/850/test
Document Length:        37 bytes

Concurrency Level:      100
Time taken for tests:   2.455 seconds
Complete requests:      1000
Failed requests:        0
Total transferred:      204000 bytes
HTML transferred:       37000 bytes
Requests per second:    407.41 [#/sec] (mean)
Time per request:       245.455 [ms] (mean)
Time per request:       2.455 [ms] (mean, across all concurrent requests)
Transfer rate:          81.16 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    1   4.1      0      16
Processing:    13  233  41.7    242     365
Waiting:        8  228  40.9    236     362
Total:         22  234  38.7    242     365

Percentage of the requests served within a certain time (ms)
  50%    242
  66%    248
  75%    252
  80%    255
  90%    261
  95%    266
  98%    275
  99%    287
 100%    365 (longest request)</code></pre>
<h2 id="sonu">Sonuç</h2>
<p>Görüldüğü gibi Obullo router paketinin performansı hız üzerine odaklanmış diğer route paketleri ile hemen hemen aynıdır. Obullo router paketi uygulamanın anlaşılabilirliğini kolaylaştırmak ve kaynakları en az kullanarak yüksek performans elde edebilmek amacıyla tasarlanmıştır. Obullo opsiyonel route sorununu route ları alt alta yazarak uygulama içerisinde çözer.</p>
<p>Bir uygulamanın performansı önce insan zihninde başlar. Daha fazla performans elde etmek için uygulamanızı tasarlarken Pipe nesnesi ile route kümelerini gruplara ayırın. Her bir route kümesi için maksimum route sayısının 50-100 arasında olmasına özen gösterin.</p>
<!-- CONTENT END -->

            </article>
            <aside class="sidebar">
                <hr>
                <h2>Obullo Components</h2>
<!--                 <h3>Links</h3> --> 
                <div class="bulletlink"><a href="http://obullo.com">Homepage</a></div>
                <div class="bulletlink"><a href="http://github.com/obullo/Router">Github Repository</a></div>
                <hr>
                <p></p>
            </aside>
            <footer>
                <hr>

<!-- FOOTER BEGIN -->


<!-- FOOTER END -->
            Website generated with <a href="http://couscous.io">Couscous</a>.
            </footer>
        </main>

        <script src="/assets/toc.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/plugins/autoloader/prism-autoloader.min.js"></script>
        <script>Prism.plugins.autoloader.languages_path = "https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/components/";</script>
        <link rel="stylesheet" href="/assets/prism.css">
        <!-- Livereload -->
        <script>
            document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] +
                    ':35729/livereload.js?snipver=1"></' + 'script>')
        </script>
        <!-- End Livereload -->
    </body>
</html>
